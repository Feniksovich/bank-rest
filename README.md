# Bank REST API

REST API для управления банковскими картами с системой аутентификации и авторизации с использованием JWT токенов на базе Spring Security.

[К инструкции для запуска ↗](#развертывание-в-docker)

## Возможности

### Для пользователей
- **Регистрация и аутентификация**: создание аккаунта и вход в систему
- **Управление профилем**: просмотр и редактирование личных данных
- **Управление картами**: просмотр своих банковских карт, блокировка, переводы
- **Безопасный выход**: выход из системы с инвалидацией использованного токена или всех выпущенных токенов

### Для администраторов
- **Управление пользователями**: 
  - Просмотр всех пользователей с пагинацией
  - Поиск пользователей по номеру телефона
  - Получение, обновление и удаление пользователей
- **Управление картами**:
  - Просмотр всех карт в системе
  - Поиск карт по ID пользователя
  - Создание новых карт для пользователей
  - Активация и блокировка карт
  - Удаление карт

## Стек технологий

### Основной стек
- **Java**: 23
- **Spring Boot**: 3.5.6
- **Spring Security**: 6.x (в составе Spring Boot)

### База данных и миграции
- **PostgreSQL**: 18
- **Liquibase** для управления схемой базы данных

### Безопасность и JWT
- **Nimbus JOSE JWT**: 9.40 (для работы с JWT токенами)
- **BCrypt** для хеширования паролей
- **AES-GCM** для шифрования номеров карт

### Документация и утилиты
- **SpringDoc OpenAPI**: 2.8.5 (Swagger UI)
- **ModelMapper**: 3.2.0 (для маппинга объектов)
- **Lombok**: для уменьшения boilerplate кода

### Тестирование
- **JUnit 5**
- **Mockito**

## Безопасность

### Аутентификация и авторизация
Реализована схема с выпуском пары токенов – доступа (Access Token) и обновления (Refresh Token).
#### Access Token
Короткоживущий токен, подписывается с помощью секретного JWK (JSON Web Key) Используется для аутентификации и авторизации при выполнении запросов.
#### Refresh Token
Долгоживущий *одноразовый* токен, *шифруется* с помощью секретного JWK. Используется для обновления токена доступа и при выходе из системы. 
> [!NOTE] 
> Система отслеживает использование токенов обновления и инвалидирует их при каждом использовании. Это обеспечивает дополнительный уровень безопасности в случае его компрометации.

> [!NOTE]  
> Токен обновления шифруется для обеспечения безопасности дополнительных данных о пользователе или его устройстве, если таковые присутствуют в токене.
### Шифрование данных
- **Пароли**: хэшируются с использованием BCrypt
- **Номера карт**: шифруются с использованием AES-GCM алгоритма с помощью секретного ключа

## Развертывание в Docker

### Быстрый запуск

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/Feniksovich/bank-rest.git
   cd bank-rest
   ```

2. Создайте файл параметров окружения:
   ```bash
   cp .env.example .env
   ```

3. Настройте переменные окружения в файле `.env` *(опционально)*

4. Запустите приложение с помощью Docker Compose:
   ```bash
   docker-compose up -d
   ```

Приложение будет доступно по адресу `http://localhost:8080`

### Запуск тестового профиля

1. Создайте файл параметров окружения для тестов:
   ```bash
   cp .env.example .env.test
   ```

2. Запустите тесты с помощью профиля Docker Compose:
   ```bash
   docker-compose --profile test up --build --abort-on-container-exit
   ```

### Документация API

После запуска приложения документация API доступна по адресу:
- **Swagger UI**: `http://localhost:8080/swagger-ui/index.html`
- **OpenAPI JSON**: `http://localhost:8080/v3/api-docs`

## Обратная связь

- maxsimus.i@yandex.ru
- [Telegram ↗](https://bit.ly/3X40VCN)
- [feniksovich.github.io ↗ ](https://feniksovich.github.io)